#!/bin/bash

set -e

APP_DIR="/home/phd/app"
GIT_DIR="/home/phd/repo.git"

echo "=========================================="
echo "Git Push Received - Starting Deployment"
echo "=========================================="

# Checkout latest code
echo "Checking out code to $APP_DIR..."
mkdir -p $APP_DIR
git --work-tree=$APP_DIR --git-dir=$GIT_DIR checkout -f

# Run deployment script
echo "Running deployment script..."
cd $APP_DIR
chmod +x deploy/deploy.sh
./deploy/deploy.sh

echo "=========================================="
echo "Deployment triggered successfully!"
echo "=========================================="
