NSE_BSE_STOCK_MASTER = {
    "RELIANCE": {"nse": "RELIANCE.NS", "bse": "RELIANCE.BO", "names": ["Reliance", "Reliance Industries", "RIL"]},
    "TCS": {"nse": "TCS.NS", "bse": "TCS.BO", "names": ["TCS", "Tata Consultancy Services", "Tata Consultancy"]},
    "HDFCBANK": {"nse": "HDFCBANK.NS", "bse": "HDFCBANK.BO", "names": ["HDFC Bank", "HDFCBANK", "HDFC"]},
    "INFY": {"nse": "INFY.NS", "bse": "INFY.BO", "names": ["Infosys", "INFY"]},
    "ICICIBANK": {"nse": "ICICIBANK.NS", "bse": "ICICIBANK.BO", "names": ["ICICI Bank", "ICICIBANK", "ICICI"]},
    "HINDUNILVR": {"nse": "HINDUNILVR.NS", "bse": "HINDUNILVR.BO", "names": ["Hindustan Unilever", "HUL", "HINDUNILVR"]},
    "ITC": {"nse": "ITC.NS", "bse": "ITC.BO", "names": ["ITC", "ITC Limited"]},
    "SBIN": {"nse": "SBIN.NS", "bse": "SBIN.BO", "names": ["SBI", "State Bank", "State Bank of India", "SBIN"]},
    "BHARTIARTL": {"nse": "BHARTIARTL.NS", "bse": "BHARTIARTL.BO", "names": ["Bharti Airtel", "Airtel", "BHARTIARTL"]},
    "KOTAKBANK": {"nse": "KOTAKBANK.NS", "bse": "KOTAKBANK.BO", "names": ["Kotak Bank", "Kotak Mahindra Bank", "KOTAKBANK"]},
    "LT": {"nse": "LT.NS", "bse": "LT.BO", "names": ["L&T", "LT", "Larsen & Toubro", "Larsen and Toubro"]},
    "AXISBANK": {"nse": "AXISBANK.NS", "bse": "AXISBANK.BO", "names": ["Axis Bank", "AXISBANK"]},
    "ASIANPAINT": {"nse": "ASIANPAINT.NS", "bse": "ASIANPAINT.BO", "names": ["Asian Paints", "ASIANPAINT", "Asian Paint"]},
    "MARUTI": {"nse": "MARUTI.NS", "bse": "MARUTI.BO", "names": ["Maruti", "Maruti Suzuki", "MARUTI"]},
    "TITAN": {"nse": "TITAN.NS", "bse": "TITAN.BO", "names": ["Titan", "TITAN"]},
    "SUNPHARMA": {"nse": "SUNPHARMA.NS", "bse": "SUNPHARMA.BO", "names": ["Sun Pharma", "Sun Pharmaceutical", "SUNPHARMA"]},
    "WIPRO": {"nse": "WIPRO.NS", "bse": "WIPRO.BO", "names": ["Wipro", "WIPRO"]},
    "ULTRACEMCO": {"nse": "ULTRACEMCO.NS", "bse": "ULTRACEMCO.BO", "names": ["UltraTech Cement", "UltraTech", "ULTRACEMCO"]},
    "TATASTEEL": {"nse": "TATASTEEL.NS", "bse": "TATASTEEL.BO", "names": ["Tata Steel", "TATASTEEL"]},
    "TATAMOTORS": {"nse": "TATAMOTORS.NS", "bse": "TATAMOTORS.BO", "names": ["Tata Motors", "TATAMOTORS"]},
    "M&M": {"nse": "M&M.NS", "bse": "M&M.BO", "names": ["Mahindra & Mahindra", "M&M", "M and M", "Mahindra"]},
    "NESTLEIND": {"nse": "NESTLEIND.NS", "bse": "NESTLEIND.BO", "names": ["Nestle India", "Nestle", "NESTLEIND"]},
    "BAJFINANCE": {"nse": "BAJFINANCE.NS", "bse": "BAJFINANCE.BO", "names": ["Bajaj Finance", "BAJFINANCE"]},
    "BAJAJFINSV": {"nse": "BAJAJFINSV.NS", "bse": "BAJAJFINSV.BO", "names": ["Bajaj Finserv", "BAJAJFINSV"]},
    "HCLTECH": {"nse": "HCLTECH.NS", "bse": "HCLTECH.BO", "names": ["HCL Tech", "HCL Technologies", "HCLTECH"]},
    "ONGC": {"nse": "ONGC.NS", "bse": "ONGC.BO", "names": ["ONGC", "Oil and Natural Gas Corporation"]},
    "NTPC": {"nse": "NTPC.NS", "bse": "NTPC.BO", "names": ["NTPC", "National Thermal Power"]},
    "POWERGRID": {"nse": "POWERGRID.NS", "bse": "POWERGRID.BO", "names": ["Power Grid", "POWERGRID"]},
    "TECHM": {"nse": "TECHM.NS", "bse": "TECHM.BO", "names": ["Tech Mahindra", "TECHM"]},
    "DIVISLAB": {"nse": "DIVISLAB.NS", "bse": "DIVISLAB.BO", "names": ["Divi's Lab", "Divis Lab", "DIVISLAB"]},
    "DRREDDY": {"nse": "DRREDDY.NS", "bse": "DRREDDY.BO", "names": ["Dr Reddy", "Dr Reddy's", "DRREDDY"]},
    "CIPLA": {"nse": "CIPLA.NS", "bse": "CIPLA.BO", "names": ["Cipla", "CIPLA"]},
    "ADANIENT": {"nse": "ADANIENT.NS", "bse": "ADANIENT.BO", "names": ["Adani Enterprises", "ADANIENT"]},
    "ADANIPORTS": {"nse": "ADANIPORTS.NS", "bse": "ADANIPORTS.BO", "names": ["Adani Ports", "ADANIPORTS"]},
    "ADANIPOWER": {"nse": "ADANIPOWER.NS", "bse": "ADANIPOWER.BO", "names": ["Adani Power", "ADANIPOWER"]},
    "BANKBARODA": {"nse": "BANKBARODA.NS", "bse": "BANKBARODA.BO", "names": ["Bank of Baroda", "BOB", "BANKBARODA"]},
    "PNB": {"nse": "PNB.NS", "bse": "PNB.BO", "names": ["Punjab National Bank", "PNB"]},
    "CANBK": {"nse": "CANBK.NS", "bse": "CANBK.BO", "names": ["Canara Bank", "CANBK"]},
    "UNIONBANK": {"nse": "UNIONBANK.NS", "bse": "UNIONBANK.BO", "names": ["Union Bank", "UNIONBANK"]},
    "INDUSINDBK": {"nse": "INDUSINDBK.NS", "bse": "INDUSINDBK.BO", "names": ["IndusInd Bank", "INDUSINDBK"]},
    "FEDERALBNK": {"nse": "FEDERALBNK.NS", "bse": "FEDERALBNK.BO", "names": ["Federal Bank", "FEDERALBNK"]},
    "RBLBANK": {"nse": "RBLBANK.NS", "bse": "RBLBANK.BO", "names": ["RBL Bank", "RBLBANK"]},
    "CSBBANK": {"nse": "CSBBANK.NS", "bse": "CSBBANK.BO", "names": ["CSB Bank", "CSBBANK", "CSB"]},
    "SUZLON": {"nse": "SUZLON.NS", "bse": "SUZLON.BO", "names": ["Suzlon", "Suzlon Energy", "SUZLON"]},
    "APOLLOTYRE": {"nse": "APOLLOTYRE.NS", "bse": "APOLLOTYRE.BO", "names": ["Apollo Tyres", "Apollo Tyre", "APOLLOTYRE", "Apple Tires", "Apple Tyres"]},
    "MRF": {"nse": "MRF.NS", "bse": "MRF.BO", "names": ["MRF", "MRF Tyres"]},
    "CEAT": {"nse": "CEAT.NS", "bse": "CEAT.BO", "names": ["CEAT", "CA", "CEAT Tyres"]},
    "JK TYRE": {"nse": "JKTYRE.NS", "bse": "JKTYRE.BO", "names": ["JK Tyre", "JK Tyres", "JKTYRE"]},
    "ASHOKLEY": {"nse": "ASHOKLEY.NS", "bse": "ASHOKLEY.BO", "names": ["Ashok Leyland", "ASHOKLEY", "Australia"]},
    "INOXWIND": {"nse": "INOXWIND.NS", "bse": "INOXWIND.BO", "names": ["Inox Wind", "INOXWIND", "Inoxint"]},
    "JINDALSAW": {"nse": "JINDALSAW.NS", "bse": "JINDALSAW.BO", "names": ["Jindal Saw", "JINDALSAW", "Jindal 100"]},
    "RECLTD": {"nse": "RECLTD.NS", "bse": "RECLTD.BO", "names": ["REC", "REC Limited", "RECLTD"]},
    "SWSOLAR": {"nse": "SWSOLAR.NS", "bse": "SWSOLAR.BO", "names": ["SW Solar", "SWSOLAR", "GSW Energy", "Silon Energy"]},
    "BEL": {"nse": "BEL.NS", "bse": "BEL.BO", "names": ["BEL", "Bharat Electronics", "BAL"]},
    "HAL": {"nse": "HAL.NS", "bse": "HAL.BO", "names": ["HAL", "Hindustan Aeronautics", "HL"]},
    "APOLLOMICRO": {"nse": "APOLLOMICRO.NS", "bse": "APOLLOMICRO.BO", "names": ["Apollo Micro", "APOLLOMICRO"]},
    "PARAGMILK": {"nse": "PARAGMILK.NS", "bse": "PARAGMILK.BO", "names": ["Parag Milk", "PARAGMILK", "Parag Mill"]},
    "URBANCOM": {"nse": "MAMAEARTH.NS", "bse": "MAMAEARTH.BO", "names": ["Urban Company", "URBANCOM"]},
    "JEWELLERY": {"nse": "TITAN.NS", "bse": "TITAN.BO", "names": ["JWL", "Jewellery"]},
    "ANANTRАЈ": {"nse": "ANANTRAJ.NS", "bse": "ANANTRAJ.BO", "names": ["Anant Raj", "ANANTRAJ"]},
    "VODAFONEIDEA": {"nse": "IDEA.NS", "bse": "IDEA.BO", "names": ["Vodafone", "Vodafone Idea", "IDEA"]},
    "SWIGGY": {"nse": "SWIGGY.NS", "bse": "SWIGGY.BO", "names": ["Swiggy", "SWIGGY"]},
    "HDBFIN": {"nse": "HDBFIN.NS", "bse": "HDBFIN.BO", "names": ["HDB Finance", "HDBFIN"]},
}


def get_stock_symbol(company_name):
    """
    Get NSE/BSE stock symbol from company name (case-insensitive, fuzzy matching)
    Returns: (symbol, stock_name) or (None, None)
    """
    company_upper = company_name.upper().strip()
    
    for symbol, data in NSE_BSE_STOCK_MASTER.items():
        for name in data["names"]:
            if name.upper() == company_upper or company_upper in name.upper() or name.upper() in company_upper:
                return data["nse"], data["names"][0]
    
    return None, None


def fuzzy_match_stock(text):
    """
    Find all stock mentions in a text using fuzzy matching
    Returns: list of (stock_name, symbol, confidence)
    """
    matches = []
    text_upper = text.upper()
    
    for symbol, data in NSE_BSE_STOCK_MASTER.items():
        for name in data["names"]:
            if name.upper() in text_upper:
                matches.append((data["names"][0], data["nse"], 1.0))
                break
    
    return matches
